-- Cleanup
DROP TABLE IF EXISTS vote;
DROP TABLE IF EXISTS post;
DROP TABLE IF EXISTS thread;
DROP TABLE IF EXISTS forum;
DROP TABLE IF EXISTS user;

CREATE TABLE user (
	id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
	nickname TEXT UNIQUE COLLATE NOCASE NOT NULL,
	email TEXT UNIQUE COLLATE NOCASE NOT NULL,
	fullname TEXT,
	about TEXT,
	is_delited bool DEFAULT false
);

CREATE TABLE forum (
	id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
	admin_id INTEGER,
	title TEXT DEFAULT "",
	slug TEXT DEFAULT "",
	is_delited bool DEFAULT false,
	FOREIGN KEY (admin_id) REFERENCES Users(id) ON DELETE SET NULL
);

CREATE TABLE thread (
	id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
	author_id INTEGER,
	forum_id INTEGER,
	title TEXT DEFAULT "",
	message TEXT DEFAULT "",
	slug TEXT default "",
	created DATETIME,
	is_delited bool DEFAULT false,
	FOREIGN KEY (author_id) REFERENCES Users(id) ON DELETE SET NULL,
	FOREIGN KEY (forum_id) REFERENCES Forums(id) ON DELETE CASCADE
);

CREATE TABLE vote (
	id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
	user_id INTEGER NOT NULL,
	thread_id INTEGER NOT NULL,
	voice TINYINT default 1,
	is_delited bool DEFAULT false,
	FOREIGN KEY (user_id) REFERENCES Users(id) ON DELETE cascade,
	FOREIGN KEY (thread_id) REFERENCES Threads(id) ON DELETE CASCADE
);

CREATE TABLE post (
	id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
	user_id INTEGER,
	parent_id INTEGER,
	thread_id INTEGER NOT NULL,
	message TEXT default "",
	edited BOOL DEFAULT false,
	is_delited BOOL DEFAULT false,
	FOREIGN KEY (user_id) REFERENCES Users(id) ON DELETE SET NULL,
	FOREIGN KEY (parent_id) REFERENCES Posts(id) ON DELETE SET NULL,
	FOREIGN KEY (thread_id) REFERENCES Threads(id) ON DELETE CASCADE
);